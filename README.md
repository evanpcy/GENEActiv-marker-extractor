# GENEActiv Marker Extractor

This repository provides python scripts used to:
- extract event markers from GENEActiv CSV file
- convert them into a GGIR-compatible sleep log

## Usage
### Extract time stamps 
Use `extract_markers.py` to extract button press time stamps  from a single CSV or a folder of CSVs generated by the GENEActiv software.  

Single file to DataFrame:
``` python
from extract_markers import extract_markers
df = extract_markers("exampleRaw/S003.csv")
```

Batch extract all CSVs to an output folder: 
``` python
from extract_markers import bulk_extract_markers
bulk_extract_markers("exampleRaw", "exampleMarker")
```

Manual checking is required after extraction. Please verify that:
- the first entry corresponds to the onset for Night 1
- the time stamps alternate correctly between onset and wake-up
- there are two time stamps for each day in sequence (add empty rows if data is missing)
- no multiple entries for the same onset or wake-up

### Convert to GGIR format
After manual cleaning, use `convert_sleeplog.py` to generate a basic GGIR sleep log.

Convert a single file to dataframe: 
``` python
from convert_sleeplog import convert_sleeplog
df = convert_sleeplog("exampleMarker/S004_markers.csv")
```

Convert all files in the folder and combine into a single sleep_log.csv:

``` python
# The ID for each entry will be derived from the corresponding filename. 
from convert_sleeplog import bulk_convert_sleeplogs
bulk_convert_sleeplogs("exampleMarker")
```
Example output (basic sleep log):
| ID           | onset_N1 | wakeup_N1 | onset_N2 | wakeup_N2 | ... |
| ------------ | -------- | --------- | -------- | --------- | --- | 
| S004_markers | 18:33:21 | 23:38:21  | 07:12:21 | 00:46:21  | ... |

Note: Column names are not used by GGIR for the basic format, but are retained here to aid review.


For details on GGIR sleep log formats, see: [link](https://wadpac.github.io/GGIR/articles/chapter9_SleepFundamentalsGuiders.html#guider-sleeplog)